# Nginx Notes

-----

## 一、常用命令

> **cd /usr/local/nginx/sbin**：进入到目录

**./nginx**：启动

**./nginx -s stop**：停止

**./nginx -s quit**：安全退出

**./nginx -s reload**： 重新加载配置文件

**ps aux|grep nginx**：查看nginx进程

---

## 二、作用

- **反向代理**：反向代理（ReverseProxy）方式是指==以代理服务器来接受请求==，然后==将请求转发给内部网络上的服务器==，并将从服务器上得到的结果返回请求连接的客户端，简单来说就是==真实的服务器不能直接被外部网络访问，想要访问必须通过代理==。
- **动静分离**：运用Nginx的反向代理功能分发请求：==所有动态资源的请求交给应用服务器==，而==静态资源的请求（例如图片、视频、CSS、JavaScript文件等）则直接由Nginx返回到浏览器==，这样能大大==减轻应用服务器的压力==。
- **负载均衡**：负载均衡也是 Nginx常用的一个功能，当==一台服务器的单位时间内的访问量越大时，服务器压力就越大==，大到超过自身承受能力时，服务器就会崩溃。为了避免服务器崩溃，让用户有更好的体验，我们==通过负载均衡的方式来分担服务器压力==。我们可以建立很多很多服务器，组成一个服务器集群，当用户访问网站时，先访问一个中间服务器，在让这个中间服务器在服务器集群中选择一个压力较小的服务器，然后将该访问请求引入该服务器。如此以来，用户的每次访问，都会保证服务器集群中的每个服务器压力趋于平衡，分担了服务器压力，避免了服务器崩溃的情况。负载均衡配置==一般都需要同时配置反向代理，通过反向代理跳转到负载均衡==。

**nginx的负载均衡策略可以划分为两大类**

- 内置策略
  - 包含==加权轮询==和ip hash，在默认情况下这两种策略会编译进nginx内核，只需在nginx配置中指明参数即可
- 扩展策略
  - 扩展策略有很多，如fair、通用hash、consistent hash等，默认不编译进nginx内核

```xml
upstream backserver { 
ip_hash; 	//每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。
server 192.168.0.14 weight=8; 
server 192.168.0.15 weight=8;
} 
```

